@using System.Security.Claims
@{
    ViewBag.Title = "سفارش کالا";
}

<link href="~/lib/ModulesCss/AdmissionForm.css" rel="stylesheet"/>
<link href="~/lib/ModalePrint/PrintCss.css" rel="stylesheet"/>

<div class="content-page displaynone" id="content-page">
<div class="content" id="admissionSaleFormBox" tabindex="-1">
<div class="container-fluid">
<div class="row">
<div class="col-12">
<div class="card m-b-30 m-t-15" id="form">
<div class="header-title d-flex">
    @*@await Html.PartialAsync("/Modules/MC/AdmissionHeaderForms/HeaderForms.cshtml")*@
    <div class="row col-md-5 header-form-box">
        <span>@ViewBag.Title</span>
    </div>
    <div class="button-items">
        <button id="list_sale" type="button" class="btn btn_green_1 waves-effect"><i class="fa fa-list-ul"></i>لیست</button>
        <button id="saveFormSale" type="button" class="btn btn-success waves-effect" title="Ctrl + S"><i class="fa fa-save"></i>ذخیره</button>
        <button id="saveFormSaleAndPrint" type="button" class="btn btn-success waves-effect" title="Ctrl + S"><i class="fa fa-save"></i>ذخیره و چاپ</button>
        <button id="newFormSale" type="button" class="btn btn-info waves-effect"><i class="fa fa-plus-circle"></i>جدید</button>
    </div>
</div>
<div class="card-body">
<div class="row d-none" id="admBox">
    <div class="col-12 row">
        <div class="form-group col-lg-1 col-sm-2">
            <label>شناسه</label>
            <div>
                <input id="admItemId" type="text" class="form-control number" maxlength="10" readonly value="@ViewContext.RouteData.Values["id"]"/>
            </div>
        </div>
        <div class="form-group col-lg-3 col-sm-3">
            <label>تاریخ / زمان</label>
            <input id="dateTime" type="text" class="form-control number" placeholder="____/__/__" maxlength="10" readonly/>
        </div>
        <div class="form-group col-lg-2 col-sm-3">
            <label>ثبت کننده</label>
            <input id="userFullName" type="text" class="form-control" readonly/>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>مرحله</label>
            <input id="stageName" type="text" class="form-control" readonly/>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>جریان کار</label>
            <input id="workflowName" type="text" class="form-control" readonly/>
        </div>
    </div>
</div>

<fieldset class="group-box group-box-orange mt-3" id="patientForm" data-parsley-validate>

    <button id="searchPatient" type="button" class="btn btn-light border-orange searchPatientBtn" style="float:left;margin:-28px 0 0 15px" onclick="searchPatient()" title="جستجو (Ctrl+Shift+f)"><i class="fa fa-search"></i>جستجو</button>
    <legend>مراجعه کننده</legend>
    <div class="row">
        <div class="form-group col-lg-2 col-sm-2">
            <label>شناسه</label>
            <div>
                <input id="patientId" type="text" class="form-control number" disabled maxlength="50"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2 d-none">
            <div>
                <input id="admissionMasterId" type="text" class="form-control number" disabled maxlength="50"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4">
            <label>نوع مراجعه</label>
            <div class="col-lg-12 chosen-container-parent">
                <select id="referralTypeId" data-placeholder="انتخاب کنید" class="form-control select2" tabindex="1" required data-parsley-errors-container="#referralTypeIdCodeErrorContainer">
                </select>
            </div>
            <div id="referralTypeIdCodeErrorContainer"></div>
        </div>
        <div class="form-group col-lg-4 col-sm-4 basicInsurer-section">
            <label>بیمه اجباری / صندوق بیمه</label>
            <div class="col-lg-12 chosen-container-parent">
                <select id="basicInsurerLineId" class="form-control select2" tabindex="2" required data-parsley-errors-container="#basicInsurerLineIdErrorContainer">
                </select>
            </div>
            <div id="basicInsurerLineIdErrorContainer"></div>
        </div>

        <div class="form-group col-lg-2 col-sm-2">
            <label>نمبر تذکره / نمبر تابعیت (خارجی )</label>
            <div class="input-group bootstrap-touchspin bootstrap-touchspin-injected">
                <input id="nationalCode" type="text" name="nationalCode" class="form-control  str-number" maxlength="12" tabindex="3" data-parsley-nationalcodeadmission="" data-parsley-errors-container="#nationalCodeErrorContainer"/>
            </div>
            <div id="nationalCodeErrorContainer"></div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>سال تولد</label>
            <div class="input-group">
                <input id="birthYear" placeholder="تاریخ تولد" type="text" class="form-control number" tabindex="-1" maxlength="4" title="برای استعلام هویت سال تولد الزامی می باشد"/>
                <div class="input-group-append">
                    <button id="getPersobByBirthWS" style="align-items: center;border:none !important;" class="btn btn-secondary bootstrap-touchspin-up" type="button" data-toggle="tooltip" data-placement="bottom" title="وب سرویس استعلام هویت">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>نام</label>
            <div>
                <input id="firstName" type="text" class="form-control atoz-valid" title="" data-parsley-group="addservice" required data-parsley-maxlength="50" tabindex="4"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-3">
            <label> تخلص</label>
            <div>
                <input id="lastName" type="text" class="form-control atoz-valid" title="" data-parsley-group="addservice" required data-parsley-maxlength="50" tabindex="5"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>تاریخ تولد</label>
            <div>
                <input id="birthDatePersian" type="text" class="form-control persian-date" placeholder="____/__/__" data-parsley-shamsidate maxlength="10" tabindex="6" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>جنسیت</label>
            <div>
                <select id="genderId" class="form-control select2" title="" data-parsley-group="addservice" required data-parsley-notequalnumber="0" data-parsley-errors-container="#genderIdErrorContainer" tabindex="7">
                    <option selected value="0">انتخاب کنید</option>
                    <option value="1">مرد</option>
                    <option value="2">زن</option>
                </select>
            </div>
            <div id="genderIdErrorContainer"></div>
        </div>
        <div class="form-group col-lg-2 col-sm-2 basicInsurer-section">
            <label>ملیت</label>
            <div class="col-lg-12 chosen-container-parent">
                <select id="countryId" data-placeholder="انتخاب کنید" class="form-control select2" tabindex="8"></select>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-3">
            <label>موبایل</label>
            <div>
                <input id="mobile" type="text" class="form-control str-number" maxlength="11" data-parsley-mobileno="" tabindex="9"/>
            </div>
        </div>
        <div class="form-group col-lg-4 col-sm-4 compInsurer-section">
            <label>بیمه تکمیلی/طرف قرارداد</label>
            <div class="col-lg-12 chosen-container-parent">
                <select id="compInsurerId" data-placeholder="انتخاب کنید" class="form-control select2" tabindex="10">
                </select>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-3 thirdParty-section">
            <label> تخفیف</label>
            <div class="col-lg-12 chosen-container-parent">
                <select id="discountInsurerId" data-placeholder="انتخاب کنید" class="form-control select2" tabindex="11">
                </select>
            </div>
        </div>
        <div class="form-group col-lg-1 col-sm-1" style="margin-top:6px">
            <label></label>
            <div class="col-lg-12 chosen-container-parent">
                <button id="editSectionPatient" type="button" class="btn btn-light border-orange" disabled tabindex="-1">ویرایش</button>
            </div>
        </div>
    </div>
    <button type="button" id="expandAdmissionSale" onclick="expandAdmission(this)" class="btn btn-light border-orange plus">
        <i class="fas fa-plus"></i>
    </button>
    <div class="slideToggle get" style="display:none;">
        <div class="row">
            <div class="form-group col-lg-2 col-sm-2">
                <label>تذکره کاغذی</label>
                <div>
                    <input id="idCardNumber" type="text" tabindex="1000000" maxlength="13" class="form-control str-number"/>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2">
                <label>نمبر خانه (Postal Code)</label>
                <div>
                    <input id="postalCode" type="text" tabindex="1000001" maxlength="10" class="form-control number"/>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2">
                <label>شغل</label>
                <div>
                    <input id="jobTitle" type="text" tabindex="1000002" maxlength="50" class="form-control"/>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2">
                <label>تلفن</label>
                <div>
                    <input id="phoneNo" type="text" tabindex="1000003" maxlength="11" class="form-control str-number"/>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2">
                <label>وضعیت تاهل</label>
                <div>
                    <select id="maritalStatusId" tabindex="1000004" class="form-control select2">
                        <option value="0">انتخاب کنید</option>
                        <option value="1">طلاق گرفته</option>
                        <option value="2">متاهل</option>
                        <option value="3">مجرد</option>
                        <option value="4">همسر فوت شده</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2 basicInsurer-section">
                <label>تحصیلات</label>
                <div class="col-lg-12 chosen-container-parent">
                    <select id="educationLevelId" data-placeholder="انتخاب کنید" class="form-control select2" tabindex="1000005"></select>
                </div>
            </div>
            <div class="form-group col-lg-2 col-sm-2">
                <label>نام پدر</label>
                <div>
                    <input id="fatherFirstName" maxlength="50" tabindex="1000006" type="text" class="form-control atoz-valid"/>
                </div>
            </div>
            <div class="form-group col-lg-4 col-sm-5">
                <label>آدرس</label>
                <div>
                    <input id="address" type="text" class="form-control" onkeydown="tabkeyDownAddress(event)" tabindex="1000007" maxlength="100"/>
                </div>
            </div>
        </div>
    </div>
</fieldset>

<fieldset id="itemForm" class="group-box group-box-blue mt-3">
    <legend>کالا</legend>
    <div class="row">

        <div class="form-group col-lg-4 col-sm-4-5">
            <label>کالا</label>
            <div class="col-12 chosen-container-parent">
                <select data-placeholder="انتخاب کنید" id="itemId" class="form-control select2" tabindex="12">
                    <option></option>
                </select>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>تعداد</label>
            <div>
                <input id="qty" type="text" class="form-control number" maxlength="7" tabindex="13" value="1"/>
            </div>
        </div>
        <div class="form-group col-lg-4 col-sm-4-5">
            <label>صفات </label>
            <div>
                <div class="col-12 chosen-container-parent">
                    <select id="itemcategoryattribute" class="form-control select2" tabindex="14" disabled></select>
                </div>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4">
            <label>واحد اندازه گیری</label>
            <div>
                <input id="unitItemName" type="text" class="form-control" maxlength="3" disabled tabindex="15"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4">
            <label>تامین کننده</label>
            <div>
                <input id="vendorId" type="text" class="form-control" disabled tabindex="16"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4">
            <label>قرارداد</label>
            <div>
                <select id="contractTypeId" class="form-control select2" title="" tabindex="17" disabled>
                    <option value="1">1 - قطعی</option>
                    <option value="2">2 - امانی</option>
                    <option value="3">3 - کمیسیونی</option>
                </select>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-2">
            <label>مدل قیمت گذاری</label>
            <div>
                <input id="pricingModelName" type="text" class="form-control" maxlength="8" disabled tabindex="18"/>
                <input id="pricingModelId" type="hidden" class="form-control d-none" disabled tabindex="19"/>
            </div>
        </div>

        <div class="form-group col-lg-3 col-sm-5 displaynone" id="pricingRangeBox">
            <label>نرخ</label>
            <div>
                <input id="minPrice" style="width:30%;float:right" type="text" class="form-control money" maxlength="10" tabindex="20" disabled value="000,000,000"/>
                <input id="price" style="width:30%;float:right;margin:0 5px 0 5px" type="text" class="form-control money" maxlength="11" tabindex="21"/>
                <input id="maxPrice" style="width:30%;float:right" type="text" class="form-control money" maxlength="10" tabindex="22" disabled value="000,000,000"/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4" id="pricingFixBox">
            <label>نرخ</label>
            <div>
                <input id="fixPrice" type="text" class="form-control money" style="background-color:#c6c6c6" maxlength="10" tabindex="23" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4 basicInsurer-section">
            <label>مبلغ پایه کالا (حاصلضرب تعداد * نرخ) </label>
            <div>
                <input id="basicItemPrice" type="text" class="form-control money" maxlength="12" tabindex="24" disabled/>
            </div>
        </div>

        <div class="form-group col-lg-2 col-sm-4 basicInsurer-section">
            <label>سهم بیمه اجباری</label>
            <div>
                <input id="basicShareAmount" type="text" class="form-control money" maxlength="12" tabindex="25" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4 compInsurer-section">
            <label>سهم بیمه تکمیلی</label>
            <div>
                <input id="compShareAmount" type="text" class="form-control money" maxlength="12" tabindex="26" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4 compInsurer-section">
            <label>سهم طرف قرارداد</label>
            <div>
                <input id="thirdPartyAmount" type="text" class="form-control money" maxlength="12" tabindex="27" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-4">
            <label>سهم تخفیف</label>
            <div>
                <input id="discountAmount" type="text" class="form-control money" maxlength="12" tabindex="28" disabled/>
            </div>
        </div>
        <div class="form-group col-lg-2 col-sm-3">
            <label>خالص قابل دریافت</label>
            <div>
                <input id="netAmount" type="text" class="form-control money" maxlength="10" disabled tabindex="29"/>
            </div>
        </div>
        <div class="col-lg-12 col-sm-12 text-right">
            <div class="button-items">
                <button id="addItem" type="button" class="btn btn-light border-blue" style="margin-bottom: 10px" tabindex="30"><i class="fa fa-arrow-down"></i>افزودن</button>
            </div>
        </div>

        <div class="table-responsive">
            <div id="hasItemError"></div>
            <table class="table table-styles border mb-0" id="pagetable">
                <thead>
                <tr>
                    <th class="col-width-percent-5">ردیف</th>
                    <th class="col-width-percent-20">کالا</th>
                    <th class="col-width-percent-5">تعداد</th>
                    <th class="col-width-percent-8">نرخ</th>
                    <th class="col-width-percent-8">تعرفه پایه کالا</th>
                    <th class="col-width-percent-8">سهم بیمه اجباری</th>
                    <th class="col-width-percent-8">سهم بیمه تکمیلی</th>
                    <th class="col-width-percent-8">سهم طرف قرارداد </th>
                    <th class="col-width-percent-5">سهم تخفیف</th>
                    <th class="col-width-percent-5">خالص قابل دریافت</th>
                    <th class="col-width-percent-5">عملیات</th>
                </tr>
                </thead>
                <tbody id="tempItem">
                <tr id="emptyRow">
                    <td colspan="11" class="text-center">سطری وجود ندارد</td>
                </tr>
                </tbody>
                <tbody id="sumRowItem" class="displaynone">
                <tr>
                    <td class="text-left" colspan="9">جمع</td>
                    <td style="background-color:#c6c6c6;font-weight:bold" class="money sumNetPrice">۰</td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</fieldset>
</div>
</div>
</div>
</div> <!-- end col -->
</div>
</div>
</div>

<div id="printAdmissionItemModal" class="modal fade" tabindex="-1" data-keyboard="false" role="dialog" aria-labelledby="modal_title" aria-hidden="true" onkeydown="modal_onkeydown(event, this)">
    <div class="modal-dialog modal-size-xs">
        <div class="modal-content">
            <div class="modal-header bg-header">
                <div class="text-right">
                    <h5 class="modal-title mt-2" id="modal_title">چاپ</h5>
                </div>
            </div>
            <div class="modal-body modal-max-height text-right" data-parsley-validate style="padding:0;">
                <div class="card-body" style="padding:0;">
                    <div class="input-group col-12 PrnModalDiv">
                        <i class="fa fa-print fa-modal-print"></i>
                        <a id="separationPrint" onclick="printAdmission('Prn_AdmissionSales.mrt',1)" class="btn btn-default" style="font-weight:bolder;">چاپ تفکیک<sub class="text-gray mr-2 font-11 color-navy">( Ctrl + 1 )</sub></a>
                    </div>
                    <div class="input-group col-12 PrnModalDiv">
                        <i class="fa fa-print fa-modal-print"></i>
                        <a id="standPrint" onclick="printAdmission('Prn_AdmissionStand.mrt',1)" class="btn btn-default" style="font-weight:bolder;">چاپ کیوسک<sub class="text-gray mr-2 font-11 color-navy">( Ctrl + 4 )</sub></a>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="border:0;">
                <button id="modal-close" onclick="modal_close('printAdmissionItemModal')" class="btn btn-secondary waves-effect" title="Esc"><i class="fa fa-times-circle"></i>انصراف</button>
            </div>
        </div>
    </div>
</div>

@await Html.PartialAsync("/Modules/SearchPatientModal.cshtml")

@await Html.PartialAsync("/Modules/SearchPatientInsurerModal.cshtml")

<script>
    $('.carousel').carousel({interval: false});
    var userId = "@User.FindFirstValue("UserId")";
</script>
<script src="/js/formplate.js"></script>
<script src="~/js/admission.js?ver=@Guid.NewGuid().ToString().Replace("-", "")"></script>

<script src="/Modules/MC/AdmissionItem/AdmissionItemForm.js?ver=@Guid.NewGuid().ToString().Replace("-", "")"></script>