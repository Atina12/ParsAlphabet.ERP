(function(n){n.fn.suggestBox=function(t){function w(n){if(!/^[a-zA-Z0-9ا-ی_.-]*$/.test(n))return!1;let t=nt(n);ut(t.data)}function nt(t){let i=tt(d,t),r=n.ajax({url:p,type:"post",async:!1,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(i),success:function(n){return n},error:function(n){error_handler(n,p)}});return r.responseJSON}function tt(n,t){let i={},r={};return i.parameters=[],i.form_KeyValue=g,i.items=typeof s.items=="undefined"?[]:s.items,i.filter=typeof s.filter=="undefined"?"":s.filter,r.name=n,r.value=t,i.parameters.push(r),i}function b(n){i.val(n);f()}function y(t,i=0){let r=n(`#${t}_${i}`);r.length>0&&(n(".suggest-row").removeClass("highlight-suggest"),r.addClass("highlight-suggest").focus())}function f(){n(`#${u}`).html("");rt()}function it(){i.addClass("suggest-box-open");n(`#${u}`).addClass("suggest-container-open");n(`#${o} i`).addClass("fa-angle-up").removeClass("fa-angle-down");e=!0}function rt(){i.removeClass("suggest-box-open");n(`#${u}`).removeClass("suggest-container-open");n(`#${o} i`).removeClass("fa-angle-up").addClass("fa-angle-down");e=!1}function ut(t){let o=t.length,r="";if(n(`#${u}`).html(r),o>0){for(var i=0;i<o;i++)r+=`<div class="suggest-row" id="suggestRow_${i}" tabindex="-1">${t[i].name}</div>`;n(`#${u}`).html(r);n(`#${u} .suggest-row`).off("click");n(`#${u} .suggest-row`).on("click",function(){b(n(this).text())});n(`#${u} .suggest-row`).off("keydown");n(`#${u} .suggest-row`).on("keydown",function(t){if([KeyCode.ArrowDown,KeyCode.ArrowUp,KeyCode.Enter,KeyCode.Esc].includes(t.keyCode)){let i=n(this),r=i.attr("id").split("_")[0],u=+i.attr("id").split("_")[1];t.keyCode===KeyCode.ArrowDown?(t.preventDefault(),t.stopPropagation(),y(r,u+1)):t.keyCode===KeyCode.ArrowUp?(t.preventDefault(),t.stopPropagation(),y(r,u-1)):t.keyCode===KeyCode.Enter?(t.preventDefault(),t.stopPropagation(),b(i.text())):t.keyCode===KeyCode.Esc&&e&&(t.preventDefault(),t.stopPropagation(),f())}});it()}else f()}let r=t,k=r.doneTypingInterval!=undefined?r.doneTypingInterval:500,p=r.api,c=3,d=r.paramterName,s=typeof r.suggestFilter=="undefined"?{}:r.suggestFilter,g=typeof r.form_KeyValue=="undefined"?[]:r.form_KeyValue,l=typeof r.callBackSearche=="undefined"?()=>!0:r.callBackSearche,i=n(this),e=!1,a=i.attr("id"),u=`suggestContainer_${a}`,v=`suggestContainer_removeItem_${a}`,o=`suggestContainer_openContiner_${a}`;if(i.parent().find(".suggest-container").length==0){let n=`      
                    <span id="${v}" class="suggest-icon suggest-icon-remove">×</span>
                    <span id="${o}" class="suggest-icon suggest-icon-open"><i class="fas fa-angle-down"></i></span>
                    <div id="${u}" class="suggest-container"></div>
                `;i.parent().append("<div class='suggest-main'><\/div>");i.appendTo(i.parent().find(".suggest-main"));i.parent().append(n)}i.addClass("suggest-box");i.parent().addClass("position-relative");var h;clearTimeout(h);i.off("keydown");i.on("keydown",function(n){n.keyCode===KeyCode.Esc&&e&&(n.preventDefault(),n.stopPropagation(),f());clearTimeout(h)});i.off("keyup");i.on("keyup",function(t){if(t.keyCode===KeyCode.ArrowDown&&n(".suggest-container").hasClass("suggest-container-open")){y("suggestRow");return}if(t.keyCode!=KeyCode.Enter&&t.keyCode!=KeyCode.ArrowDown&&t.keyCode!=KeyCode.Esc&&l()){let n=i.val();n.length>=c&&l()&&(clearTimeout(h),h=setTimeout(()=>{w(n)},k))}});i.off("input change");i.on("input change",function(){let n=i.val();n.length<c&&f()});i.off("blur");i.on("blur",function(t){nextElm=n(t.relatedTarget);nextElm.hasClass("suggest-row")||e&&f()});n(`#${v}`).off("click");n(`#${v}`).on("click",function(){i.val("");f()});n(`#${o}`).off("click");n(`#${o}`).on("click",function(){if(e)f();else{let n=i.val();n.length>=c&&l()&&w(n)}});i.trigger("change")}})(jQuery);